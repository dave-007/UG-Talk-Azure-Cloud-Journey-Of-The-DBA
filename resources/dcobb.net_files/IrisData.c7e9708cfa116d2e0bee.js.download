(window.webpackJsonp=window.webpackJsonp||[]).push([["IrisData"],{Em1F:function(e,t){},QnRU:function(e,t,a){"use strict";a.d(t,"a",(function(){return E})),a.d(t,"c",(function(){return P})),a.d(t,"b",(function(){return A}));var r=a("D57K"),i=a("HDSB"),s=a("tMmC");const n=new class{constructor(){this.userNurturingPref="ntp.user_nurturing"}getAllCampaigns(){return new Promise(e=>{try{Object(i.a)()&&window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate.getPref?window.chrome.ntpSettingsPrivate.getPref(this.userNurturingPref,(function(t){t&&t.value?e(t.value):(s.a.logError("PSL: window.chrome.ntpSettingsPrivate.getPref does not have campaigns."),e([]))})):(s.a.logError("PSL: window.chrome.ntpSettingsPrivate.getPref does not exist."),e([]))}catch(t){s.a.logError(t),e([])}})}persistCampaigns(e){return new Promise(t=>{try{Object(i.a)()&&window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate.setPref?(window.chrome.ntpSettingsPrivate.setPref(this.userNurturingPref,e),s.a.log(`PSL: Number of campaigns persisted: ${e.length||0}.`),t(!0)):(s.a.logError("PSL: window.chrome.ntpSettingsPrivate.setPref does not exist."),t(!1))}catch(e){s.a.logError(e),t(!1)}})}clearPersistentStorage(){return this.persistCampaigns([])}};var o=a("dTwT");const c=new class{constructor(){this.storageKey="irisNewsLocalStorage"}getAllCampaigns(){try{return o.a.getObject(this.storageKey)}catch(e){return s.a.logError(`Exception ${e} occurred retrieving user nurturing campaigns from local storage`),[]}}storeCampaigns(e){try{return o.a.setObject(this.storageKey,e),s.a.log(`Number of campaigns persisted in local storage: ${e.length||0}.`),!0}catch(e){return s.a.logError(`Exception ${e} occurred storing user nurturing campaigns in local storage`),!1}}clearLocalStorage(){return this.storeCampaigns([])}};var u=a("HxRh"),l=a("rvYQ"),h=a("ADRF"),d=a("y+Kz"),g=a("I6Lx"),f=a("ypwz"),p=a("s9+9"),m=a("Tn4X"),b=a("tERu"),C=a("ljWX"),v=a("VZ41"),S=a("XgsJ"),I=a("9J8d"),y=a("gqHb"),w=a("XLvf");const E=new class{constructor(){this.cachedSurfaceMap=new Map,this.millisecondsInADay=864e5,this.timeNow=(new Date).getTime(),this.enabledFeatures=[],this.appType=l.a&&l.a.AppType,this.appType===f.a.EdgeChromium&&this.getConfigDataAsync()}get isEnabled(){return!!this.shouldUseCache()||!(!this.irisDataConfig||!this.irisDataConfig.enableCaching)&&this.isCookieConsentNotRequired()}set IrisDataConfig(e){this.irisDataConfig=e}clearCachedSurfaceMap(){this.isEnabled&&this.cachedSurfaceMap.clear()}populateCachedSurfaceMap(){return Object(r.b)(this,void 0,void 0,(function*(){if(this.isEnabled)try{if(this.purgeCacheWithQsp())return yield this.clearCachedSurfacesFromStorage(),void s.a.log("Cache purged!");this.clearCachedSurfaceMap();let e=[];if(e=l.a.AppType===f.a.EdgeChromium?yield n.getAllCampaigns():c.getAllCampaigns(),!e||0===e.length)return void s.a.log("Bulk read of surfaces from local/persistent storage didn't return a surface.");const{subscribers:t}=this.irisDataConfig,a=[];Object.keys(t).forEach(e=>{t[e].active||a.push(C.b[e])}),e.forEach(e=>{e&&e.placement&&(0===a.length||-1===a.indexOf(e.placement))&&(s.a.log(`Populated ${e.placement} from local/persistent storage.`),this.cachedSurfaceMap.set(e.placement,e),this.highestLastAddedTime=0,e.creatives&&e.creatives.length>0&&e.creatives.forEach(e=>{e&&e.storageInfo&&e.storageInfo.lastAddedTime&&(this.highestLastAddedTime=e.storageInfo.lastAddedTime>=this.highestLastAddedTime?e.storageInfo.lastAddedTime:this.highestLastAddedTime)}))})}catch(e){s.a.logError("Bulk read of surfaces from local/persistent storage threw error: "+e)}}))}getLatestCachedSurface(e,t){if(!e||0===e.length||0===this.cachedSurfaceMap.size)return null;if(!this.cachedSurfaceMap.has(e))return null;const a=this.cachedSurfaceMap.get(e);if(!a||!a.creatives||0===a.creatives.length)return null;if(t!==C.c.MSNAnaheimNewsNTPImages)return a;const r=this.getStorageCachingExpiration();let i=!1;return a.creatives.forEach(e=>{e&&e.storageInfo&&e.storageInfo.lastAddedTime&&this.timeNow-e.storageInfo.lastAddedTime<r&&(i=!0)}),i?a:null}addSurfaceToMap(e){if(!e||!e.placement)return;const t=e.placement,a=new Map;if(this.cachedSurfaceMap.has(t)){this.cachedSurfaceMap.get(t).creatives.forEach(e=>{a.set(e.creativeId,e)})}e.creatives&&e.creatives.forEach(e=>{const t={useCount:0,lastAddedTime:this.timeNow};e.storageInfo=t,a.set(e.creativeId,e)}),e.creatives=[...a.values()],s.a.log(`Adding SurfaceInfo ${t} in storage.`),this.cachedSurfaceMap.set(t,e)}addSurfaceCollectionToStorage(e){return Object(r.b)(this,void 0,void 0,(function*(){e&&e.length>0&&(e.forEach(e=>{this.addSurfaceToMap(e)}),yield this.persistAllSurfaces())}))}persistAllSurfaces(){return Object(r.b)(this,void 0,void 0,(function*(){if(this.isEnabled){if(l.a.AppType===f.a.EdgeChromium)return void(yield n.persistCampaigns([...this.cachedSurfaceMap.values()]));c.storeCampaigns([...this.cachedSurfaceMap.values()])}}))}clearCachedSurfacesFromStorage(){return Object(r.b)(this,void 0,void 0,(function*(){this.isEnabled&&(this.clearCachedSurfaceMap(),l.a.AppType!==f.a.EdgeChromium?c.clearLocalStorage():yield n.clearPersistentStorage())}))}getCachedSurfaceMap(){return this.cachedSurfaceMap}HaveWeShownASurfaceRecently(){return this.highestLastAddedTime>0&&this.timeNow-this.highestLastAddedTime<this.getTimeBetweenShowingDifferentCreatives()}isUserSeenAllCreativesInSurface(e){if(!e||0===e.length)return!1;if(this.cachedSurfaceMap.has(e)){const t=this.cachedSurfaceMap.get(e);let a=0;if(t&&t.creatives&&t.creatives.length>0)return t.creatives.forEach(e=>{e.storageInfo&&e.storageInfo.useCount&&e.storageInfo.lastAddedTime&&(e.storageInfo.useCount>=this.getReshowingCounterForEachCreative()||this.timeNow-e.storageInfo.lastAddedTime<=this.getTimeBetweenReshowingSameCreative())&&a++}),t.creatives.length===a}return!1}filterCreatives(e){if(!e||!this.shouldUseMaximumCapPerCreative())return e;const t=this.irisDataConfig&&this.irisDataConfig.maximumCapPerCreative||2,a=[];return e.creatives.forEach(e=>{e.storageInfo&&e.storageInfo.useCount<=t&&a.push(e)}),e.creatives=a,e}updateAction(e,t,a){if(e&&t&&this.cachedSurfaceMap.has(e)){const r=this.cachedSurfaceMap.get(e);r&&r.creatives&&r.creatives.forEach(e=>{e.creativeId===t&&e.storageInfo&&(e.storageInfo.irisAction=a)})}}markCreativeAsSeenByUser(e,t){if(e&&t&&this.cachedSurfaceMap.has(e)){const a=this.cachedSurfaceMap.get(e);a&&a.creatives&&a.creatives.forEach(e=>{e&&e.creativeId&&e.creativeId===t&&e.storageInfo&&(e.storageInfo.useCount++,e.storageInfo.lastAddedTime=this.timeNow)})}}hasUserDismissedAllStoredSurfaceCreatives(e){if(!e||0===e.length)return!1;if(this.cachedSurfaceMap.has(e)){const t=this.cachedSurfaceMap.get(e);let a=0;if(t&&t.creatives&&t.creatives.length>0)return t.creatives.forEach(e=>{if(!e.storageInfo||!e.storageInfo.irisAction||e.storageInfo.irisAction!==v.a.Dismiss)return!1;a++}),t.creatives.length===a}return!1}updateCreativeLatestAddedTime(e,t,a){if(!this.cachedSurfaceMap.has(e))return;const r=this.cachedSurfaceMap.get(e);r&&r.creatives&&0!==r.creatives.length&&r.creatives.forEach(e=>{e&&e.creativeId===t&&e.storageInfo&&e.storageInfo.lastAddedTime&&(e.storageInfo.lastAddedTime=a)})}getStorageCachingExpiration(){return(this.irisDataConfig&&this.irisDataConfig.storageCachingExpiration||1)*this.millisecondsInADay}getReshowingCounterForEachCreative(){return this.irisDataConfig&&this.irisDataConfig.frequency||2}getTimeBetweenReshowingSameCreative(){return(this.irisDataConfig&&this.irisDataConfig.frequencyInterval||14)*this.millisecondsInADay}getTimeBetweenShowingDifferentCreatives(){return(this.irisDataConfig&&this.irisDataConfig.frequencyIntervalBetweenCreatives||1)*this.millisecondsInADay}purgeCacheWithQsp(){const e=Object(S.k)();if(e){const t=h.a.getQueryParameterByName("purgeCache",e);if(t&&"true"===t.toLocaleLowerCase())return!0}return!1}shouldUseCache(){const e=Object(S.k)();if(e){const t=h.a.getQueryParameterByName("useCache",e);if(t)return"true"===t.toLocaleLowerCase()}return!1}shouldUseMaximumCapPerCreative(){const e=Object(S.k)();if(e){const t=h.a.getQueryParameterByName("useMaxCapPerCreative",e);if(t)return"true"===t.toLocaleLowerCase()}return!0}isCookieConsentNotRequired(){const e=I.a.getInstance().rootReducer.connector(p.a.SharedState),t=e&&e.getCurrentState();return(t&&t.cookieConsentStatus)===m.a.NotRequired}getConfigDataAsync(){return Object(r.b)(this,void 0,void 0,(function*(){return this.getConfigDataPromise=new Promise(e=>{try{Object(i.a)()&&window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate.getConfigData?window.chrome.ntpSettingsPrivate.getConfigData(t=>{void 0!==t?(this.profileCreationTimeInMs=t.profileCreationTime,this.enabledFeatures=t.enabledFeatures,e()):(y.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Hb.ConfigDataUndefined),{message:"Config data is undefined"})),e())}):(y.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Hb.FailedToFetchConfigData),{message:"Failed to fetch config data from chromium API"})),e())}catch(t){y.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Hb.ExceptionFetchingConfigData),{message:"Exception fetching config data from chromium API",pb:Object.assign(Object.assign({},u.Hb.ExceptionFetchingConfigData.pb),{customMessage:"Exception: "+t})})),e()}}),this.getConfigDataPromise}))}isBlackoutPeriodOver(){return Object(r.b)(this,void 0,void 0,(function*(){this.appType===f.a.EdgeChromium&&(yield this.getConfigDataPromise);const e=this.irisDataConfig.blackoutPeriodInDays&&this.irisDataConfig.blackoutPeriodInDays*this.millisecondsInADay||7*this.millisecondsInADay;return!!this.profileCreationTimeInMs&&this.timeNow-this.profileCreationTimeInMs>e}))}isNurturingEnabled(){return Object(r.b)(this,void 0,void 0,(function*(){return this.appType===f.a.EdgeChromium&&(yield this.getConfigDataPromise),!!this.enabledFeatures&&this.enabledFeatures.indexOf("msUserNurturing")>=0}))}};function P(){return Object(r.b)(this,void 0,void 0,(function*(){if(yield A())return!1;try{return!1!==o.a.getObject(d.t)}catch(e){return y.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Hb.FailedToReadNurturingAcceptedFlag),{message:"Failed to fetch nurturing accepted key from local storage",pb:Object.assign(Object.assign({},u.Hb.FailedToReadNurturingAcceptedFlag.pb),{customMessage:`Exception: ${e} occurred while reading key: ${d.t} from local storage.`})})),!1}}))}function A(){return Object(r.b)(this,void 0,void 0,(function*(){yield l.a.AccountInfoPromise;const e=l.a.ResolvedAccountInfo;return Object(w.isNullOrUndefined)(g.b.AadState)?b.b.AAD===(e&&e.account_type):g.b.AadState}))}},RUyI:function(e,t){},dkoE:function(e,t,a){"use strict";a.r(t),a.d(t,"IrisDataConnector",(function(){return N})),a.d(t,"IrisDataReducer",(function(){return j})),a.d(t,"IrisSurfaceName",(function(){return l.c})),a.d(t,"RegisterErrorTrackingCallback",(function(){return E.a})),a.d(t,"ToolingInfo",(function(){return D})),a.d(t,"isNurturingAccepted",(function(){return r.c})),a.d(t,"isAadAccount",(function(){return r.b}));var r=a("QnRU"),i=a("Em1F"),s=a("D57K"),n=a("1w6q"),o=a("rvYQ"),c=a("ax+D"),u=a("ADRF"),l=a("ljWX"),h=a("VZ41"),d=a("SPwp"),g=a("Vvi2"),f=a("a5Dy"),p=a("tMmC"),m=a("HxRh"),b=a("ypwz"),C=a("4wjP"),v=a("Ozxe");const S={[b.a.HomePage]:"1",[b.a.Edge+C.b.DHP]:"2",[b.a.EdgeChromium+C.b.DHP]:"2",[b.a.Edge+C.b.NTP]:"3",[b.a.EdgeChromium+C.b.NTP]:"3",[b.a.Windows]:"7",[b.a.WindowsShell]:"7",[b.a.Finance]:"8",[b.a.Hub]:"8",[b.a.Weather]:"8",[b.a.Views]:"9",[b.a.MicrosoftNews]:"11",[b.a.MMX+C.b.Launcher]:"12"},I={[v.a.Edge]:"1",[v.a.Chrome]:"2",[v.a.InternetExplorer]:"3",[v.a.Firefox]:"4",[v.a.Safari]:"5",[v.a.Chromium]:"6",[v.a.EdgeChromium]:"6"};var y=a("hOj1"),w=a("I6Lx"),E=a("gqHb"),P=a("r6MD");class A{static runValidation(e){switch(e){case l.c.MSNAnaheimNewsNTPImages:return;case l.c.MSNNewsCoachmark:case l.c.MSNNewsCoachmark+l.a:return{addToCall:!0,parameters:{nocookie:"0"}};case l.c.ConditionalBanner:case l.c.ConditionalBanner+l.a:return{addToCall:!0,parameters:Object.assign({},A.getConditionalBannerIrisCallParameters(e))};case l.c.MSNewsRewards:case l.c.MSNewsRewards+l.a:return{addToCall:!0,parameters:{nocookie:"0"}};default:return void E.a.trackAppErrorEvent(Object.assign(Object.assign({},m.Hb.SubscriberNotFound),{message:"Subscriber validation function not found.",pb:Object.assign(Object.assign({},m.Hb.SubscriberNotFound.pb),{customMessage:"Subscriber: "+e})}))}}static getConditionalBannerIrisCallParameters(e){const t=new Object;t.nocookie="0";const a=Object(y.a)(w.b.AnonCookieName);t.ISSIGNEDIN=a?"1":"0";const r=Object(P.a)(w.b,"ClientSettings.apptype"),i=Object(P.a)(w.b,"ClientSettings.pagetype"),s=A.mapCanvasId(r,i);s&&(t.MSN_CANVAS=s);const n=Object(P.a)(w.b,"ClientSettings.browser");if(n){const e=n.ismobile;e&&(t.ISMOBILE="TRUE"===e.toUpperCase()?"1":"0");const a=I[n.browserType];a&&(t.BROWSER=a)}const o=[];return"ISSIGNEDIN"in t||o.push("ISSIGNEDIN"),"MSN_CANVAS"in t||o.push("MSN_CANVAS"),"ISMOBILE"in t||o.push("ISMOBILE"),"BROWSER"in t||o.push("BROWSER"),o.length>0&&E.a.trackAppErrorEvent(Object.assign(Object.assign({},m.Hb.MissingIrisParameterForConditionalBanner),{message:"Missing parameters for subscriber",pb:Object.assign(Object.assign({},m.Hb.MissingIrisParameterForConditionalBanner.pb),{customMessage:`parameters ${o.toString()} for subscriber ${e}`})})),t}static mapCanvasId(e,t){let a=null;switch(e){case b.a.Edge:case b.a.EdgeChromium:case b.a.MMX:a=[e+t];break;default:a=e}return S[a]}}var O=a("XgsJ");class N extends n.a{constructor(e,t,a,i,n,c,u){super(e,t,a,i,n,c,u),this.surfaceInfoMap=new Map,!c.disableIrisCalls&&c.subscribers?(this.irisDataPromise=new Promise(e=>Object(s.b)(this,void 0,void 0,(function*(){r.a.IrisDataConfig=c,this.appType=o.a&&o.a.AppType,this.internalPlacementUsed=Object(l.i)(),this.appType&&(this.appType!==b.a.EdgeChromium||(yield r.a.isBlackoutPeriodOver()))?(yield r.a.populateCachedSurfaceMap(),this.internalPlacementUsed===this.shouldUseCacheForInternalPlacements()&&Object.keys(this.config.subscribers).forEach(e=>{const t=this.internalPlacementUsed?e+l.a:e,a=l.b[t],i=r.a.getLatestCachedSurface(a,t);i&&i.placement&&this.surfaceInfoMap.set(a,i)}),yield this.prepareCallData(),this.queryParameters&&0!==this.queryParameters.placement.length?(this.callIris(),this.callWasMade=!0):this.callWasMade=!1,e()):this.callWasMade=!1}))),this.irisDataPromise):this.callWasMade=!1}sendActionUpdate(e,t,a,i,s){let n;e&&t&&(a===h.b.Impression?r.a.markCreativeAsSeenByUser(e,t):r.a.updateAction(e,t,s),r.a.persistAllSurfaces()),n=a===h.b.Impression?i.impressionUrl:d.a.formatTelemetryActionUrl(i.actionUrl,s),g.a.sendActionUpdate(n)}getPayload(e){return Object(s.b)(this,void 0,void 0,(function*(){let t;yield this.irisDataPromise,this.callWasMade&&(yield this.irisCallPromise);let a=this.shouldUseRequestedIrisSurface();if(a&&(this.internalPlacementUsed&&(a+=l.a),t=l.b[a]),!t){const e=Array.from(this.surfaceInfoMap.keys());let a=0;do{t=e[Math.floor(Math.random()*e.length)]}while(t===l.b[l.c.MSNAnaheimNewsNTPImages]&&a++<e.length);if(t===l.b[l.c.MSNAnaheimNewsNTPImages])return null}const r=e&&this.internalPlacementUsed?e+l.a:e;return r&&t!==l.b[r]?(p.a.log(`IrisDataConnector: Surface requested ${l.b[r]} by experience is not same as surface ${t} picked.`),null):yield this.tryGetSurfaceInfo(t)}))}tryGetSurfaceInfo(e){return Object(s.b)(this,void 0,void 0,(function*(){if(!this.surfaceInfoMap.has(e))return p.a.log(`IrisDataConnector: Placement: ${e} was not populated by local/persistent storage nor downloaded by network call.`),null;let t=this.surfaceInfoMap.get(e);return l.b[l.c.MSNAnaheimNewsNTPImages]===e||this.shouldBlockPsl()?t:(yield Object(r.b)())?(p.a.log(`IrisDataConnector: This is AAD user so not returning SurfaceInfo for: ${e} to experience.`),null):this.isUserNurturedWithOneSurface?(p.a.log(`IrisDataConnector: Already sent surfaceInfo so not returning SurfaceInfo for: ${e} to experience.`),null):r.a.HaveWeShownASurfaceRecently()?(p.a.log(`IrisDataConnector: Already shown a campaign within 24 hours so not returning SurfaceInfo for: ${e} to experience.`),null):r.a.isUserSeenAllCreativesInSurface(e)?(p.a.log(`IrisDataConnector: We have already shown this so not returning SurfaceInfo for: ${e} to experience.`),null):(t=r.a.filterCreatives(t),this.isUserNurturedWithOneSurface=!0,p.a.log(`IrisDataConnector: Returning SurfaceInfo for: ${e} to experience.`),t)}))}prepareCallData(){return Object(s.b)(this,void 0,void 0,(function*(){const{subscribers:e}=this.config,t=[],a=[],i=[];let s,n;const o=yield r.a.isNurturingEnabled(),u=yield Object(r.c)();Object.keys(e).forEach(r=>{if(!e[r].active)return;const h=this.internalPlacementUsed?r+l.a:r,d=l.b[h];if(d){if((!this.appType||this.appType!==b.a.EdgeChromium||l.b[l.c.MSNAnaheimNewsNTPImages]===d||u&&o)&&!this.surfaceInfoMap.has(d)){const{creativeCount:o,performValidation:u,staticQueryParams:l,aflights:g}=e[r];if(u&&(s=A.runValidation(h),!s||!s.addToCall))return;let f=o||1;if(f=s&&s.parameters&&s.parameters.bcnt?s.parameters.bcnt:f,f<=0)return void E.a.trackAppErrorEvent(Object.assign(Object.assign({},m.Hb.CreativeCountNegativeOrZero),{message:"Creative count value is negative or zero",pb:Object.assign(Object.assign({},m.Hb.CreativeCountNegativeOrZero.pb),{customMessage:"Creative count value is negative or zero : "+h})}));if(t.push(d),a.push(f),c.a.isNotNullOrUndefined(l)&&(n=Object.assign(Object.assign({},n),l)),s&&s.parameters&&c.a.isNotNullOrUndefined(s.parameters)&&(n=Object.assign(Object.assign({},n),s.parameters)),s&&s.headers&&c.a.isNotNullOrUndefined(s.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),s.headers)),c.a.isNotNullOrUndefined(g)&&"object"==typeof g)for(const e in g)g[e]&&i.push(g[e])}}else E.a.trackAppErrorEvent(Object.assign(Object.assign({},m.Hb.SubscriberNotFoundInIrisPlacementDictionary),{message:"Subscriber not found in iris placement dictionary",pb:Object.assign(Object.assign({},m.Hb.SubscriberNotFoundInIrisPlacementDictionary.pb),{customMessage:`Subscriber ${h} not found in dictionary`})}))}),c.a.isNotNullOrUndefined(this.config.dynamicQueryParams)&&(n=Object.assign(Object.assign({},n),this.config.dynamicQueryParams)),this.queryParameters=Object.assign({},n),this.queryParameters.placement=t.join("|"),this.queryParameters.bcnt=a.join("|"),this.queryParameters.aflights=i.join(";")}))}callIris(){this.irisCallPromise=new Promise(e=>Object(s.b)(this,void 0,void 0,(function*(){try{this.surfaceCollection=yield g.a.requestSurfaceInfo(this.queryParameters,this.headers,this.config.irisEndpoint);const e=this.getSurfacesFromCollection();yield r.a.addSurfaceCollectionToStorage(e)}catch(e){this.callWasMade=!1,p.a.log(`IrisDataConnector: Arc call failed to return requested surfaces ${this.queryParameters.placement} due to Error: ${f.a[e.irisErr]} Error Code: ${e.irisErr} Error Nessage: ${e.statusText}`)}e()}))),this.irisCallPromise}getSurfacesFromCollection(){const e=this.config.subscribers;if(!(e&&this.surfaceCollection&&this.surfaceCollection.collection&&this.surfaceCollection.reqContext&&this.surfaceCollection.reqContext.queryParams&&this.surfaceCollection.reqContext.queryParams.placement))return null;const t=[];return Object.keys(e).forEach(e=>{const a=this.getSurfaceFromCollection(e);a&&a.placement&&(p.a.log(`IrisDataConnector: Parsed response for ${a.placement} from Iris network call. Now adding to map.`),t.push(a),this.surfaceInfoMap.set(a.placement,a))}),t}getSurfaceFromCollection(e){const t=this.internalPlacementUsed?e+l.a:e,a=l.b[t],r=this.surfaceCollection.reqContext.queryParams.placement;let i;if(-1==r.indexOf("|")){if(this.surfaceCollection.collection.hasUnclaimedErrors()){return void this.surfaceCollection.collection.getUnclaimedErrors().forEach(e=>{E.a.trackAppErrorEvent(Object.assign(Object.assign({},m.Hb.ErrorFoundForSurface),{message:"Surface errors discovered",pb:Object.assign(Object.assign({},m.Hb.ErrorFoundForSurface.pb),{customMessage:`Error with surface: ${t} Code: ${e.code} Message: ${e.msg}`})}))})}if(a===r&&this.surfaceCollection.collection.hasUnknowns()){return i=this.surfaceCollection.collection.getUnknowns()[0],i&&!i.placement&&(i.placement=a),i}}return i=this.surfaceCollection.collection.get(a),i&&!i.placement&&(i.placement=a),i}shouldUseCacheForInternalPlacements(){const e=Object(O.k)();if(e){const t=u.a.getQueryParameterByName("useCacheForInternalPlacements",e);if(t)return"true"===t.toLocaleLowerCase()}return!1}shouldUseRequestedIrisSurface(){const e=Object(O.k)();if(e){const t=u.a.getQueryParameterByName("irisSurface",e);if(t)return t}return null}shouldBlockPsl(){const e=Object(O.k)();if(e){const t=u.a.getQueryParameterByName("blockPsl",e);if(t)return"true"===t.toLocaleLowerCase()}return!1}}class j{reduce(){return null}}var M=a("RUyI");const D={experienceConfigSchema:i.IrisDataConfigSchema,mockConfig:M.mockConfig}},gqHb:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("u5KZ");class i{static registerTrackAppErrorEventCallback(e){e&&(this.trackAppErrorEventCallback=e)}static trackAppErrorEvent(e){this.trackAppErrorEventCallback&&this.trackAppErrorEventCallback(e)}}i.trackAppErrorEventCallback=e=>{r.a.sendAppErrorEvent(e)}}}]);