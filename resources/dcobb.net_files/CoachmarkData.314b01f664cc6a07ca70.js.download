(window.webpackJsonp=window.webpackJsonp||[]).push([["CoachmarkData"],{QnRU:function(e,t,r){"use strict";r.d(t,"a",(function(){return A})),r.d(t,"c",(function(){return y})),r.d(t,"b",(function(){return k}));var a=r("D57K"),i=r("HDSB"),n=r("tMmC");const s=new class{constructor(){this.userNurturingPref="ntp.user_nurturing"}getAllCampaigns(){return new Promise(e=>{try{Object(i.a)()&&window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate.getPref?window.chrome.ntpSettingsPrivate.getPref(this.userNurturingPref,(function(t){t&&t.value?e(t.value):(n.a.logError("PSL: window.chrome.ntpSettingsPrivate.getPref does not have campaigns."),e([]))})):(n.a.logError("PSL: window.chrome.ntpSettingsPrivate.getPref does not exist."),e([]))}catch(t){n.a.logError(t),e([])}})}persistCampaigns(e){return new Promise(t=>{try{Object(i.a)()&&window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate.setPref?(window.chrome.ntpSettingsPrivate.setPref(this.userNurturingPref,e),n.a.log(`PSL: Number of campaigns persisted: ${e.length||0}.`),t(!0)):(n.a.logError("PSL: window.chrome.ntpSettingsPrivate.setPref does not exist."),t(!1))}catch(e){n.a.logError(e),t(!1)}})}clearPersistentStorage(){return this.persistCampaigns([])}};var o=r("dTwT");const c=new class{constructor(){this.storageKey="irisNewsLocalStorage"}getAllCampaigns(){try{return o.a.getObject(this.storageKey)}catch(e){return n.a.logError(`Exception ${e} occurred retrieving user nurturing campaigns from local storage`),[]}}storeCampaigns(e){try{return o.a.setObject(this.storageKey,e),n.a.log(`Number of campaigns persisted in local storage: ${e.length||0}.`),!0}catch(e){return n.a.logError(`Exception ${e} occurred storing user nurturing campaigns in local storage`),!1}}clearLocalStorage(){return this.storeCampaigns([])}};var u=r("HxRh"),d=r("rvYQ"),h=r("ADRF"),g=r("y+Kz"),f=r("I6Lx"),l=r("ypwz"),m=r("s9+9"),p=r("Tn4X"),C=r("tERu"),v=r("ljWX"),b=r("VZ41"),S=r("XgsJ"),E=r("9J8d"),I=r("gqHb"),w=r("XLvf");const A=new class{constructor(){this.cachedSurfaceMap=new Map,this.millisecondsInADay=864e5,this.timeNow=(new Date).getTime(),this.enabledFeatures=[],this.appType=d.a&&d.a.AppType,this.appType===l.a.EdgeChromium&&this.getConfigDataAsync()}get isEnabled(){return!!this.shouldUseCache()||!(!this.irisDataConfig||!this.irisDataConfig.enableCaching)&&this.isCookieConsentNotRequired()}set IrisDataConfig(e){this.irisDataConfig=e}clearCachedSurfaceMap(){this.isEnabled&&this.cachedSurfaceMap.clear()}populateCachedSurfaceMap(){return Object(a.b)(this,void 0,void 0,(function*(){if(this.isEnabled)try{if(this.purgeCacheWithQsp())return yield this.clearCachedSurfacesFromStorage(),void n.a.log("Cache purged!");this.clearCachedSurfaceMap();let e=[];if(e=d.a.AppType===l.a.EdgeChromium?yield s.getAllCampaigns():c.getAllCampaigns(),!e||0===e.length)return void n.a.log("Bulk read of surfaces from local/persistent storage didn't return a surface.");const{subscribers:t}=this.irisDataConfig,r=[];Object.keys(t).forEach(e=>{t[e].active||r.push(v.b[e])}),e.forEach(e=>{e&&e.placement&&(0===r.length||-1===r.indexOf(e.placement))&&(n.a.log(`Populated ${e.placement} from local/persistent storage.`),this.cachedSurfaceMap.set(e.placement,e),this.highestLastAddedTime=0,e.creatives&&e.creatives.length>0&&e.creatives.forEach(e=>{e&&e.storageInfo&&e.storageInfo.lastAddedTime&&(this.highestLastAddedTime=e.storageInfo.lastAddedTime>=this.highestLastAddedTime?e.storageInfo.lastAddedTime:this.highestLastAddedTime)}))})}catch(e){n.a.logError("Bulk read of surfaces from local/persistent storage threw error: "+e)}}))}getLatestCachedSurface(e,t){if(!e||0===e.length||0===this.cachedSurfaceMap.size)return null;if(!this.cachedSurfaceMap.has(e))return null;const r=this.cachedSurfaceMap.get(e);if(!r||!r.creatives||0===r.creatives.length)return null;if(t!==v.c.MSNAnaheimNewsNTPImages)return r;const a=this.getStorageCachingExpiration();let i=!1;return r.creatives.forEach(e=>{e&&e.storageInfo&&e.storageInfo.lastAddedTime&&this.timeNow-e.storageInfo.lastAddedTime<a&&(i=!0)}),i?r:null}addSurfaceToMap(e){if(!e||!e.placement)return;const t=e.placement,r=new Map;if(this.cachedSurfaceMap.has(t)){this.cachedSurfaceMap.get(t).creatives.forEach(e=>{r.set(e.creativeId,e)})}e.creatives&&e.creatives.forEach(e=>{const t={useCount:0,lastAddedTime:this.timeNow};e.storageInfo=t,r.set(e.creativeId,e)}),e.creatives=[...r.values()],n.a.log(`Adding SurfaceInfo ${t} in storage.`),this.cachedSurfaceMap.set(t,e)}addSurfaceCollectionToStorage(e){return Object(a.b)(this,void 0,void 0,(function*(){e&&e.length>0&&(e.forEach(e=>{this.addSurfaceToMap(e)}),yield this.persistAllSurfaces())}))}persistAllSurfaces(){return Object(a.b)(this,void 0,void 0,(function*(){if(this.isEnabled){if(d.a.AppType===l.a.EdgeChromium)return void(yield s.persistCampaigns([...this.cachedSurfaceMap.values()]));c.storeCampaigns([...this.cachedSurfaceMap.values()])}}))}clearCachedSurfacesFromStorage(){return Object(a.b)(this,void 0,void 0,(function*(){this.isEnabled&&(this.clearCachedSurfaceMap(),d.a.AppType!==l.a.EdgeChromium?c.clearLocalStorage():yield s.clearPersistentStorage())}))}getCachedSurfaceMap(){return this.cachedSurfaceMap}HaveWeShownASurfaceRecently(){return this.highestLastAddedTime>0&&this.timeNow-this.highestLastAddedTime<this.getTimeBetweenShowingDifferentCreatives()}isUserSeenAllCreativesInSurface(e){if(!e||0===e.length)return!1;if(this.cachedSurfaceMap.has(e)){const t=this.cachedSurfaceMap.get(e);let r=0;if(t&&t.creatives&&t.creatives.length>0)return t.creatives.forEach(e=>{e.storageInfo&&e.storageInfo.useCount&&e.storageInfo.lastAddedTime&&(e.storageInfo.useCount>=this.getReshowingCounterForEachCreative()||this.timeNow-e.storageInfo.lastAddedTime<=this.getTimeBetweenReshowingSameCreative())&&r++}),t.creatives.length===r}return!1}filterCreatives(e){if(!e||!this.shouldUseMaximumCapPerCreative())return e;const t=this.irisDataConfig&&this.irisDataConfig.maximumCapPerCreative||2,r=[];return e.creatives.forEach(e=>{e.storageInfo&&e.storageInfo.useCount<=t&&r.push(e)}),e.creatives=r,e}updateAction(e,t,r){if(e&&t&&this.cachedSurfaceMap.has(e)){const a=this.cachedSurfaceMap.get(e);a&&a.creatives&&a.creatives.forEach(e=>{e.creativeId===t&&e.storageInfo&&(e.storageInfo.irisAction=r)})}}markCreativeAsSeenByUser(e,t){if(e&&t&&this.cachedSurfaceMap.has(e)){const r=this.cachedSurfaceMap.get(e);r&&r.creatives&&r.creatives.forEach(e=>{e&&e.creativeId&&e.creativeId===t&&e.storageInfo&&(e.storageInfo.useCount++,e.storageInfo.lastAddedTime=this.timeNow)})}}hasUserDismissedAllStoredSurfaceCreatives(e){if(!e||0===e.length)return!1;if(this.cachedSurfaceMap.has(e)){const t=this.cachedSurfaceMap.get(e);let r=0;if(t&&t.creatives&&t.creatives.length>0)return t.creatives.forEach(e=>{if(!e.storageInfo||!e.storageInfo.irisAction||e.storageInfo.irisAction!==b.a.Dismiss)return!1;r++}),t.creatives.length===r}return!1}updateCreativeLatestAddedTime(e,t,r){if(!this.cachedSurfaceMap.has(e))return;const a=this.cachedSurfaceMap.get(e);a&&a.creatives&&0!==a.creatives.length&&a.creatives.forEach(e=>{e&&e.creativeId===t&&e.storageInfo&&e.storageInfo.lastAddedTime&&(e.storageInfo.lastAddedTime=r)})}getStorageCachingExpiration(){return(this.irisDataConfig&&this.irisDataConfig.storageCachingExpiration||1)*this.millisecondsInADay}getReshowingCounterForEachCreative(){return this.irisDataConfig&&this.irisDataConfig.frequency||2}getTimeBetweenReshowingSameCreative(){return(this.irisDataConfig&&this.irisDataConfig.frequencyInterval||14)*this.millisecondsInADay}getTimeBetweenShowingDifferentCreatives(){return(this.irisDataConfig&&this.irisDataConfig.frequencyIntervalBetweenCreatives||1)*this.millisecondsInADay}purgeCacheWithQsp(){const e=Object(S.k)();if(e){const t=h.a.getQueryParameterByName("purgeCache",e);if(t&&"true"===t.toLocaleLowerCase())return!0}return!1}shouldUseCache(){const e=Object(S.k)();if(e){const t=h.a.getQueryParameterByName("useCache",e);if(t)return"true"===t.toLocaleLowerCase()}return!1}shouldUseMaximumCapPerCreative(){const e=Object(S.k)();if(e){const t=h.a.getQueryParameterByName("useMaxCapPerCreative",e);if(t)return"true"===t.toLocaleLowerCase()}return!0}isCookieConsentNotRequired(){const e=E.a.getInstance().rootReducer.connector(m.a.SharedState),t=e&&e.getCurrentState();return(t&&t.cookieConsentStatus)===p.a.NotRequired}getConfigDataAsync(){return Object(a.b)(this,void 0,void 0,(function*(){return this.getConfigDataPromise=new Promise(e=>{try{Object(i.a)()&&window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate.getConfigData?window.chrome.ntpSettingsPrivate.getConfigData(t=>{void 0!==t?(this.profileCreationTimeInMs=t.profileCreationTime,this.enabledFeatures=t.enabledFeatures,e()):(I.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Hb.ConfigDataUndefined),{message:"Config data is undefined"})),e())}):(I.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Hb.FailedToFetchConfigData),{message:"Failed to fetch config data from chromium API"})),e())}catch(t){I.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Hb.ExceptionFetchingConfigData),{message:"Exception fetching config data from chromium API",pb:Object.assign(Object.assign({},u.Hb.ExceptionFetchingConfigData.pb),{customMessage:"Exception: "+t})})),e()}}),this.getConfigDataPromise}))}isBlackoutPeriodOver(){return Object(a.b)(this,void 0,void 0,(function*(){this.appType===l.a.EdgeChromium&&(yield this.getConfigDataPromise);const e=this.irisDataConfig.blackoutPeriodInDays&&this.irisDataConfig.blackoutPeriodInDays*this.millisecondsInADay||7*this.millisecondsInADay;return!!this.profileCreationTimeInMs&&this.timeNow-this.profileCreationTimeInMs>e}))}isNurturingEnabled(){return Object(a.b)(this,void 0,void 0,(function*(){return this.appType===l.a.EdgeChromium&&(yield this.getConfigDataPromise),!!this.enabledFeatures&&this.enabledFeatures.indexOf("msUserNurturing")>=0}))}};function y(){return Object(a.b)(this,void 0,void 0,(function*(){if(yield k())return!1;try{return!1!==o.a.getObject(g.t)}catch(e){return I.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Hb.FailedToReadNurturingAcceptedFlag),{message:"Failed to fetch nurturing accepted key from local storage",pb:Object.assign(Object.assign({},u.Hb.FailedToReadNurturingAcceptedFlag.pb),{customMessage:`Exception: ${e} occurred while reading key: ${g.t} from local storage.`})})),!1}}))}function k(){return Object(a.b)(this,void 0,void 0,(function*(){yield d.a.AccountInfoPromise;const e=d.a.ResolvedAccountInfo;return Object(w.isNullOrUndefined)(f.b.AadState)?C.b.AAD===(e&&e.account_type):f.b.AadState}))}},U6Xm:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r("G82u");class i{}i.addCoachmark=new a.a("AddCoachmark"),i.updateCoachmarkVisibleStatus=new a.a("UpdateCoachmarkVisibleStatus")},g7TJ:function(e,t,r){"use strict";r.r(t),r.d(t,"CoachmarkDataActions",(function(){return s.a})),r.d(t,"CoachmarkDataReducer",(function(){return b})),r.d(t,"CoachmarkDataConnector",(function(){return C})),r.d(t,"CoachmarkPayload",(function(){return a.a})),r.d(t,"CoachmarkPlacement",(function(){return a.b})),r.d(t,"CoachmarkPointerPosition",(function(){return a.c})),r.d(t,"CoachmarkSource",(function(){return a.d})),r.d(t,"IrisAction",(function(){return i.a})),r.d(t,"IrisSurfaceName",(function(){return n.c})),r.d(t,"IrisTelemetryEventType",(function(){return i.b})),r.d(t,"RegisterErrorTrackingCallback",(function(){return l.a})),r.d(t,"ToolingInfo",(function(){return S}));var a=r("rcIs"),i=r("VZ41"),n=r("ljWX"),s=r("U6Xm"),o=r("D57K"),c=r("1w6q"),u=r("HxRh"),d=r("tMmC"),h=r("z5Om"),g=r("s9+9"),f=r("9J8d"),l=r("MLMI");class m{static getCoachmarksFromDataConnector(e){return Object(o.b)(this,void 0,void 0,(function*(){if(this.irisDataConnector=yield f.a.getInstance().rootReducer.getDataConnector(g.a.IrisData),!this.irisDataConnector)return l.a.trackAppErrorEvent(Object.assign(Object.assign({},u.M.IrisDataConnectorUndefined),{message:"No Iris data connector"})),null;const t=yield this.irisDataConnector.getPayload(e);if(!this.validateSurface(t,e))return null;const r=t.creatives,a=r[Math.floor(Math.random()*r.length)];return this.extractCoachmarkCreativeMessages(a,t.placement)}))}static fireIrisBeacon(e,t,r,a,i){return Object(o.b)(this,void 0,void 0,(function*(){this.irisDataConnector=yield f.a.getInstance().rootReducer.getDataConnector(g.a.IrisData),this.irisDataConnector?this.irisDataConnector.sendActionUpdate(i,a,e,t,r):l.a.trackAppErrorEvent(Object.assign(Object.assign({},u.M.IrisDataConnectorUndefined),{message:"No Iris data connector"}))}))}static validateSurface(e,t){return e?!h.a.infoHasErrors(e)||(e.errors.forEach(e=>{2040!=e.code&&l.a.trackAppErrorEvent(Object.assign(Object.assign({},u.M.ErrorFoundForSurface),{message:"Surface errors discovered",pb:Object.assign(Object.assign({},u.M.ErrorFoundForSurface.pb),{customMessage:"Error with surface: "+n.c.MSNNewsCoachmark+" Code: "+e.code+" Message: "+e.msg})}))}),!1):(d.a.log("IrisHandler: Iris surface not found for the campaign: "+e),!1)}static extractCoachmarkCreativeMessages(e,t){const r=[];let i;return e&&e.content&&e.telemetry&&e.creativeId&&t&&(e.content.cm?e.content.cm.forEach(n=>{i=Object.assign(Object.assign({},n),{ctaList:n.cta,timeoutMilliseconds:Number(n.timeoutMilliseconds),eventUrl:e.telemetry,coachmarkSource:a.d.Iris,creativeId:e.creativeId,placementId:t,frequency:Number(e.content.frequency),frequencyInterval:Number(e.content.frequencyInterval)}),r.push(i)}):(i=Object.assign(Object.assign({},e.content),{timeoutMilliseconds:Number(e.content.timeoutMilliseconds),eventUrl:e.telemetry,coachmarkSource:a.d.Iris,creativeId:e.creativeId,placementId:t,frequency:Number(e.content.frequency),frequencyInterval:Number(e.content.frequencyInterval)}),r.push(i))),r}}var p=r("QnRU");class C extends c.a{addCoachmark(e){return Object(o.b)(this,void 0,void 0,(function*(){let t=!1;if(yield Object(p.c)()){const r=a.a.extractMessages(e);if(!r||0===r.length)return!1;const i=new Promise(e=>{s.a.updateCoachmarkVisibleStatus.registerObserver(()=>{t=this.getCurrentState().isCoachmarkOnScreen,e()})});s.a.addCoachmark.getActionSender(this).send(r),yield i}return t}))}reportEvent(e,t,r,a,n){e?t?e!==i.b.Action||r?m.fireIrisBeacon(e,t,r,a,n):l.a.trackAppErrorEvent(Object.assign(Object.assign({},u.M.IrisActionUndefined),{message:"Iris action undefined"})):l.a.trackAppErrorEvent(Object.assign(Object.assign({},u.M.TelemetryInfoUndefined),{message:"Iris telemetry info not found"})):l.a.trackAppErrorEvent(Object.assign(Object.assign({},u.M.EventTypeUndefined),{message:"Event type is undefined"}))}getCoachmarks(e){return Object(o.b)(this,void 0,void 0,(function*(){return yield m.getCoachmarksFromDataConnector(e)}))}}var v=r("05Au");class b{reduce(e,t){if(!e)return{coachmarkMessages:void 0,isCoachmarkOnScreen:void 0};if(!t)return e;let r,a=!1;return a=a||v.a.handleAction(t,s.a.addCoachmark,t=>{r=Object.assign(Object.assign({},e),{coachmarkMessages:t})}),a=a||v.a.handleAction(t,s.a.updateCoachmarkVisibleStatus,t=>{r=Object.assign(Object.assign({},e),{isCoachmarkOnScreen:t})}),r||e}}const S={experienceConfigSchema:{}}},gqHb:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r("u5KZ");class i{static registerTrackAppErrorEventCallback(e){e&&(this.trackAppErrorEventCallback=e)}static trackAppErrorEvent(e){this.trackAppErrorEventCallback&&this.trackAppErrorEventCallback(e)}}i.trackAppErrorEventCallback=e=>{a.a.sendAppErrorEvent(e)}}}]);